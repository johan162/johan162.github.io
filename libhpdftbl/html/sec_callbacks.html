<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libhpdftbl: Using callbacks</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libhpdftbl<span id="projectnumber">&#160;1.4.0</span>
   </div>
   <div id="projectbrief">Table construction library for Haru PDF library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('sec_callbacks.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Using callbacks </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_ContentLabelCallbacks"></a> In the "[Getting started](GettingStarted.md)" chapter we discussed the preferred way to specify data and labels in table using data arrays. This is a very good way to populate a table in the cases the data is fairly static.</p>
<p >For data that is more dynamic and determined at runtime it is of course possible to construct the data array but the table library have one better way to do this and that is to set up label and content callbacks.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Introducing content callback functions</h1>
<p ><b>Content callbacks</b> are functions that are called by the library for each cell and returns a string which is used as the data to be displayed. The signature for a cell content callback is defined by the type <code>hpdftbl_content_callback_t</code> which is a pointer to a function defined as:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> </div>
<div class="line"><span class="keywordtype">char</span> * (*hpdftbl_content_callback_t)(<span class="keywordtype">void</span> *, size_t, size_t);</div>
</div><!-- fragment --><p> This signature is also used for label callbacks. For style setting callback the signature is instead defined as</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> </div>
<div class="line">_Bool (*<a class="code hl_typedef" href="hpdftbl_8h.html#a3d711e82876140fbd564b76c08753343">hpdftbl_content_style_callback_t</a>)(<span class="keywordtype">void</span> *, size_t, size_t, <span class="keywordtype">char</span> *content, <a class="code hl_struct" href="structtext__style.html">hpdf_text_style_t</a> *);</div>
<div class="ttc" id="ahpdftbl_8h_html_a3d711e82876140fbd564b76c08753343"><div class="ttname"><a href="hpdftbl_8h.html#a3d711e82876140fbd564b76c08753343">hpdftbl_content_style_callback_t</a></div><div class="ttdeci">_Bool(* hpdftbl_content_style_callback_t)(void *, size_t, size_t, char *content, hpdf_text_style_t *)</div><div class="ttdoc">Type specification for the content style.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:353</div></div>
<div class="ttc" id="astructtext__style_html"><div class="ttname"><a href="structtext__style.html">text_style</a></div><div class="ttdoc">Specification of a text style.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:303</div></div>
</div><!-- fragment --><p >To understand this lets start defining a callback function to specify content (or a label) that follows this signature.</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">my_cell_cb(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> row, <span class="keywordtype">size_t</span> col) { ... }</div>
</div><!-- fragment --><p >The parameters in the callback are</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>tag</code>   </td><td class="markdownTableBodyNone">Since a callback sometimes must know from what table or in what circumstances it is called it is possible to add a "tag" to ech table. This could be something as simple as pointer to a numeric identifier that uniquely identifies the table or perhaps a pointer to some function that retrieves data for this particular table.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>row</code>   </td><td class="markdownTableBodyNone">The cell row    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>col</code>   </td><td class="markdownTableBodyNone">The cell column   </td></tr>
</table>
<p >It is possible to specify a callback to adjust content, style, and labels. A callback function can be specified to be used for every cell in the table or only for a specific cell. This can also be mixed in order to have, for example, one generic callback for most cells and have a different callback for a specific cell. Any callback set for a cell will override the callback set for the table</p>
<p >The API to specify these callbacks are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">API   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="hpdftbl_8h.html#affd0f2a21048bc048b4bc5a85e227a33" title="Set table content callback.">hpdftbl_set_content_cb()</a></code>   </td><td class="markdownTableBodyNone">Specify a content callback for the entire table.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="hpdftbl_8h.html#a3bb3e58ecf4bc3bda2da271d50b291fe" title="Set callback to specify cell content style.">hpdftbl_set_content_style_cb()</a></code>   </td><td class="markdownTableBodyNone">Specify a style callback for the entire table.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="hpdftbl_8h.html#af883dd1ae69782730244efe6a76a88c2" title="Set table label callback.">hpdftbl_set_label_cb()</a></code>   </td><td class="markdownTableBodyNone">Specify a label callback for the entire table.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="hpdftbl_8h.html#aae07e6f243360d9c80c18396ed9837f2" title="Set cell content callback.">hpdftbl_set_cell_content_cb()</a></code>   </td><td class="markdownTableBodyNone">Specify callback for an individual cell. A cell callback will override<br  />
 a potential table callback.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="hpdftbl_8h.html#a52f9197df715189854f0fb5561e54ad0" title="Set cell specific callback to specify cell content style.">hpdftbl_set_cell_content_style_cb()</a></code>   </td><td class="markdownTableBodyNone">Specify a style callback for an individual cell. A cell callback will override<br  />
 a potential table callback.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="hpdftbl_8h.html#ae46a8eb1b5db85c5b03991efa249f649" title="Set cell canvas callback.">hpdftbl_set_canvas_cb()</a></code>   </td><td class="markdownTableBodyNone">This is an advanced callback to allow for low level painting directly on the <br  />
canvas that is the cell area arguments to the callback is different as it <br  />
 includes the bounding-box for th cell area. We will not further discuss this.   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><b>Returned content string</b>. The string pointer returned from a callback is never stored in the table. only printed. It is therefore perfectly possible to have a static allocated buffer in the callback function that is used to construct the content and returned from the callback.</dd></dl>
<h1><a class="anchor" id="autotoc_md37"></a>
A content callback example</h1>
<p >Let's now construct a simple example where the content and the labels are specified with callbacks.</p>
<p >We will create callbacks that will add a date string to the top left cell and just som dummy content in the rest of the cells. We could do this in two ways.</p>
<ol type="1">
<li>Add a generic table callback for all cells and then in that callback check if the row and column is (0,0) i.e. top-left and in that case create a date.</li>
<li>Add a generic table callback for all cells and then add a specific cell callback with the date for the (0,0) cell.</li>
</ol>
<p >To illustrate both methods we will use method 1 for the labels and method 2 for the content.</p>
<p >Let's first create the date callback functions we need to add a date in the top left corner of the table that reflects the current date and time.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *</div>
<div class="line">cb_date(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[64];</div>
<div class="line">    time_t t = time(NULL);</div>
<div class="line">    ctime_r(&amp;t, buf);</div>
<div class="line">    <span class="keywordflow">return</span> buf;</div>
<div class="line">}</div>
</div><!-- fragment --><p >This would be sufficient for normal usage. However, the source code in <a class="el" href="tut_ex06_8c-example.html">tut_ex06.c</a> that illustrates callbacks is slightly different:</p>
<p ></p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *</div>
<div class="line">cb_date(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[64];</div>
<div class="line">    <span class="keywordflow">if</span> ( ! <a class="code hl_variable" href="unit__test_8inc_8h.html#a78c47025bf33d069feea090f6290dd1e">run_as_unit_test</a> ) {</div>
<div class="line">        time_t t = time(NULL);</div>
<div class="line">        ctime_r(&amp;t, buf);</div>
<div class="line">        <span class="keywordflow">return</span> buf;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="ttc" id="aunit__test_8inc_8h_html_a78c47025bf33d069feea090f6290dd1e"><div class="ttname"><a href="unit__test_8inc_8h.html#a78c47025bf33d069feea090f6290dd1e">run_as_unit_test</a></div><div class="ttdeci">_Bool run_as_unit_test</div><div class="ttdoc">For the case when we use this example as a unit/integration test we do not want data such as dates,...</div><div class="ttdef"><b>Definition:</b> unit_test.inc.h:35</div></div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wed May 4 19:01:01 2022&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >The reason for this is that all these examples also serve as unit tests for the library. The way the unit tests work is by comparing the output from all these examples with stored, manually checked "correct" versions of the output. Since any date changes will make the file different we must make the dates a known value whe the examples are run as unit teets. This we know when the flag <code>run_as_unit_test</code> is true and in that case a "dummy" static date is used.</p>
<p >The content and label functions can then be written as follows</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> * cb_content(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[32];</div>
<div class="line">    snprintf(buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Content %02zu x %02zu&quot;</span>, r, c);</div>
<div class="line">    <span class="keywordflow">return</span> buf;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> * cb_labels(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[32];</div>
<div class="line">    <span class="keywordflow">if</span> (0==r &amp;&amp; 0==c) { <span class="comment">// Top-left cell</span></div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Date:&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Label %zux%zu:&quot;</span>, r, c);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> buf;</div>
<div class="line">}</div>
</div><!-- fragment --><p >We note that we ignore the tag argument. Since we only have one table there is no need to use a tag to different from which table the callback comes.</p>
<p >For the table structure we will re-use our previous example and create a 2x2 table, and we get the following table creation code:</p>
<p ></p>
<div class="fragment"><div class="line">create_table_ex06(HPDF_Doc pdf_doc, HPDF_Page pdf_page) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_rows = 2;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_cols = 2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> *table_title = <span class="stringliteral">&quot;tut_ex06: 2x2 table with callbacks&quot;</span>;</div>
<div class="line">    <a class="code hl_struct" href="structhpdftbl.html">hpdftbl_t</a> tbl = <a class="code hl_function" href="hpdftbl_8c.html#aad0f4078a299fcaebde02f16905fe51f">hpdftbl_create_title</a>(num_rows, num_cols, table_title);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#a5f4278417bc42a09aabfca973dbd31ba">hpdftbl_use_labels</a>(tbl, <a class="code hl_define" href="hpdftbl_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#a4a339735a5dae90e6349fddf6c14d152">hpdftbl_use_labelgrid</a>(tbl, <a class="code hl_define" href="hpdftbl_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#affd0f2a21048bc048b4bc5a85e227a33">hpdftbl_set_content_cb</a>(tbl, cb_content);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#af883dd1ae69782730244efe6a76a88c2">hpdftbl_set_label_cb</a>(tbl, cb_labels);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#aae07e6f243360d9c80c18396ed9837f2">hpdftbl_set_cell_content_cb</a>(tbl, 0, 0, cb_date);</div>
<div class="line"> </div>
<div class="line">    HPDF_REAL xpos = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(1);</div>
<div class="line">    HPDF_REAL ypos = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(<a class="code hl_define" href="hpdftbl_8h.html#ac8ef7b15650c2dc4e44a4c2b75359dc2">A4PAGE_HEIGHT_CM</a> - 1);</div>
<div class="line">    HPDF_REAL width = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(12);</div>
<div class="line">    HPDF_REAL height = 0;  <span class="comment">// Calculate height automatically</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Stroke the table to the page</span></div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a>(pdf_doc, pdf_page, tbl, xpos, ypos, width, height);</div>
<div class="line">}</div>
<div class="ttc" id="ahpdftbl_8c_html_a4a339735a5dae90e6349fddf6c14d152"><div class="ttname"><a href="hpdftbl_8c.html#a4a339735a5dae90e6349fddf6c14d152">hpdftbl_use_labelgrid</a></div><div class="ttdeci">int hpdftbl_use_labelgrid(hpdftbl_t t, _Bool use)</div><div class="ttdoc">Shorter vertical line to mark labels.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:681</div></div>
<div class="ttc" id="ahpdftbl_8c_html_a5f4278417bc42a09aabfca973dbd31ba"><div class="ttname"><a href="hpdftbl_8c.html#a5f4278417bc42a09aabfca973dbd31ba">hpdftbl_use_labels</a></div><div class="ttdeci">int hpdftbl_use_labels(hpdftbl_t t, _Bool use)</div><div class="ttdoc">Enable/Disable the use of cell labels.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:660</div></div>
<div class="ttc" id="ahpdftbl_8c_html_aad0f4078a299fcaebde02f16905fe51f"><div class="ttname"><a href="hpdftbl_8c.html#aad0f4078a299fcaebde02f16905fe51f">hpdftbl_create_title</a></div><div class="ttdeci">hpdftbl_t hpdftbl_create_title(size_t rows, size_t cols, char *title)</div><div class="ttdoc">Create a new table with title top row.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:320</div></div>
<div class="ttc" id="ahpdftbl_8c_html_ae07ffb136a6e6fd7311afc0acf7cf763"><div class="ttname"><a href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a></div><div class="ttdeci">int hpdftbl_stroke(HPDF_Doc pdf, const HPDF_Page page, hpdftbl_t t, const HPDF_REAL xpos, const HPDF_REAL ypos, const HPDF_REAL width, HPDF_REAL height)</div><div class="ttdoc">Stroke the table.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:1676</div></div>
<div class="ttc" id="ahpdftbl_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="hpdftbl_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdoc">Boolean truth value.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:47</div></div>
<div class="ttc" id="ahpdftbl_8h_html_aae07e6f243360d9c80c18396ed9837f2"><div class="ttname"><a href="hpdftbl_8h.html#aae07e6f243360d9c80c18396ed9837f2">hpdftbl_set_cell_content_cb</a></div><div class="ttdeci">int hpdftbl_set_cell_content_cb(hpdftbl_t t, size_t r, size_t c, hpdftbl_content_callback_t cb)</div><div class="ttdoc">Set cell content callback.</div><div class="ttdef"><b>Definition:</b> hpdftbl_callback.c:105</div></div>
<div class="ttc" id="ahpdftbl_8h_html_ac8ef7b15650c2dc4e44a4c2b75359dc2"><div class="ttname"><a href="hpdftbl_8h.html#ac8ef7b15650c2dc4e44a4c2b75359dc2">A4PAGE_HEIGHT_CM</a></div><div class="ttdeci">#define A4PAGE_HEIGHT_CM</div><div class="ttdoc">Standard A4 paper height in cm.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:198</div></div>
<div class="ttc" id="ahpdftbl_8h_html_ad1b5b1c37e8832f507e65c595a7a2d00"><div class="ttname"><a href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a></div><div class="ttdeci">#define hpdftbl_cm2dpi(c)</div><div class="ttdoc">Convert cm to dots using the default resolution (72 DPI)</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:256</div></div>
<div class="ttc" id="ahpdftbl_8h_html_af883dd1ae69782730244efe6a76a88c2"><div class="ttname"><a href="hpdftbl_8h.html#af883dd1ae69782730244efe6a76a88c2">hpdftbl_set_label_cb</a></div><div class="ttdeci">int hpdftbl_set_label_cb(hpdftbl_t t, hpdftbl_content_callback_t cb)</div><div class="ttdoc">Set table label callback.</div><div class="ttdef"><b>Definition:</b> hpdftbl_callback.c:210</div></div>
<div class="ttc" id="ahpdftbl_8h_html_affd0f2a21048bc048b4bc5a85e227a33"><div class="ttname"><a href="hpdftbl_8h.html#affd0f2a21048bc048b4bc5a85e227a33">hpdftbl_set_content_cb</a></div><div class="ttdeci">int hpdftbl_set_content_cb(hpdftbl_t t, hpdftbl_content_callback_t cb)</div><div class="ttdoc">Set table content callback.</div><div class="ttdef"><b>Definition:</b> hpdftbl_callback.c:84</div></div>
<div class="ttc" id="astructhpdftbl_html"><div class="ttname"><a href="structhpdftbl.html">hpdftbl</a></div><div class="ttdoc">Core table handle.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:470</div></div>
</div><!-- fragment --><p> Running this example gives the result shown in <b>Figure 7.</b> below, the full source code can be found in <a class="el" href="tut_ex06_8c-example.html">tut_ex06.c</a></p>
<p ><img src="tut_ex06.png" alt="" class="inline" title="tut_ex06.c"/>    <br  />
</p>
<p ><em><b>Figure 7:</b></em> <em>Using callbacks to populate the table and labels.</em></p>
<h1><a class="anchor" id="autotoc_md38"></a>
Dynamic (late binding) callbacks</h1>
<dl class="section warning"><dt>Warning</dt><dd>This is an advanced concept and while simple in theory it does have some hidden "gotchas".</dd></dl>
<p>All callback functions discussed above must exist att compile time so that the address of the functions can be determined by the compiler. As we will discuss later it is possible to define a table as a data structure to avoid having to write several lines of code in defining a table.</p>
<p >Such a data structure could in theory be stored in a database or as a text file. In that case it will not be possible to specify a callback function since the address of function is determined at link time.</p>
<p >Fortunately it is possible to specify a function name (as a string) and have the standard C-library locate where that function is stored and return a pointer to it. This pointer is then the same as if the callback had been bound at compile time.</p>
<p >There is a analog set of functions that takes a string name of the function and looks up the actual function pointer and set that as the callback.</p>
<p >Those analogue functions are</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">API   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#a751e4f7120ba3254074cf33463cd7450" title="Set the handle for scope of dynamic function search.">hpdftbl_set_dlhandle()</a>   </td><td class="markdownTableBodyNone">Option to set dynamic lib handle    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#ae6e4bfc5f76812623fe3d1cfe8b43395" title="Specify dynamic (late) loading callback content function.">hpdftbl_set_content_dyncb()</a>   </td><td class="markdownTableBodyNone">Table content late binding    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#ae64b46d9ef271732d23063f19e6da003" title="Specify dynamic (late) loading callback for table label function.">hpdftbl_set_label_dyncb()</a>   </td><td class="markdownTableBodyNone">Table label late binding    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#a7d90a6cca7a1f268be49098ba40e2ad0" title="Specify dynamic (late) loading callback for cell label function.">hpdftbl_set_cell_label_dyncb()</a>   </td><td class="markdownTableBodyNone">Table cell label latex binding    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#a8b47422f9df60c4f6eb5cf6a16d61756" title="Specify dynamic (late) loading callback for table style function.">hpdftbl_set_content_style_dyncb()</a>   </td><td class="markdownTableBodyNone">Table style late binding    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#af4863d4de5517905cd1924db35d4e9a2" title="Specify dynamic (late) loading callback for cell style function.">hpdftbl_set_cell_content_style_dyncb()</a>   </td><td class="markdownTableBodyNone">Table cell content late binding    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="hpdftbl_8h.html#a84227ee19d04fa651f61300fcc360ed4" title="Specify dynamic (late) loading callback cell canvas function.">hpdftbl_set_cell_canvas_dyncb()</a>   </td><td class="markdownTableBodyNone">Cell canvas callback   </td></tr>
</table>
<p >They are identical to hhe already described "ordinary" setting callback functions with the difference these functions take a string as argument rather than a function pointer.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Using late binding</h2>
<p >Using late binding is very similar to what we did in the previous examples, We start by defining the callback functions we need</p>
<p ></p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">cb_date(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[64];</div>
<div class="line">    <span class="keywordflow">if</span> ( ! <a class="code hl_variable" href="unit__test_8inc_8h.html#a78c47025bf33d069feea090f6290dd1e">run_as_unit_test</a> ) {</div>
<div class="line">        time_t t = time(NULL);</div>
<div class="line">        ctime_r(&amp;t, buf);</div>
<div class="line">        <span class="keywordflow">return</span> buf;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;Wed May 4 19:01:01 2022&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">cb_content(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[32];</div>
<div class="line">    snprintf(buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Content %02zu x %02zu&quot;</span>, r, c);</div>
<div class="line">    <span class="keywordflow">return</span> buf;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">cb_labels(<span class="keywordtype">void</span> *tag, <span class="keywordtype">size_t</span> r, <span class="keywordtype">size_t</span> c) {</div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> buf[32];</div>
<div class="line">    <span class="keywordflow">if</span> (0==r &amp;&amp; 0==c) {</div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Date created:&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Label %zux%zu:&quot;</span>, r, c);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> buf;</div>
<div class="line">}</div>
</div><!-- fragment --><p >It is however one crucial detail that cannot be overlooked. <b>None of the callbacks functions can be static!</b> If they are static they won't be found</p>
<p >Then it is really simple. We create the table with the function that should now be familiar and then add the callbacks with the names of the callback functions as so</p>
<div class="fragment"><div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#ae6e4bfc5f76812623fe3d1cfe8b43395">hpdftbl_set_content_dyncb</a>(tbl, <span class="stringliteral">&quot;cb_content&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#ae64b46d9ef271732d23063f19e6da003">hpdftbl_set_label_dyncb</a>(tbl, <span class="stringliteral">&quot;cb_labels&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#af89970cb863c640bc1d16951b8a4b7c8">hpdftbl_set_cell_content_dyncb</a>(tbl, 0, 0, <span class="stringliteral">&quot;cb_date&quot;</span>);</div>
<div class="ttc" id="ahpdftbl_8h_html_ae64b46d9ef271732d23063f19e6da003"><div class="ttname"><a href="hpdftbl_8h.html#ae64b46d9ef271732d23063f19e6da003">hpdftbl_set_label_dyncb</a></div><div class="ttdeci">int hpdftbl_set_label_dyncb(hpdftbl_t, const char *)</div><div class="ttdoc">Specify dynamic (late) loading callback for table label function.</div><div class="ttdef"><b>Definition:</b> hpdftbl_callback.c:349</div></div>
<div class="ttc" id="ahpdftbl_8h_html_ae6e4bfc5f76812623fe3d1cfe8b43395"><div class="ttname"><a href="hpdftbl_8h.html#ae6e4bfc5f76812623fe3d1cfe8b43395">hpdftbl_set_content_dyncb</a></div><div class="ttdeci">int hpdftbl_set_content_dyncb(hpdftbl_t, const char *)</div><div class="ttdoc">Specify dynamic (late) loading callback content function.</div><div class="ttdef"><b>Definition:</b> hpdftbl_callback.c:283</div></div>
<div class="ttc" id="ahpdftbl_8h_html_af89970cb863c640bc1d16951b8a4b7c8"><div class="ttname"><a href="hpdftbl_8h.html#af89970cb863c640bc1d16951b8a4b7c8">hpdftbl_set_cell_content_dyncb</a></div><div class="ttdeci">int hpdftbl_set_cell_content_dyncb(hpdftbl_t, size_t, size_t, const char *)</div><div class="ttdoc">Specify dynamic (late) loading callback cell content function.</div><div class="ttdef"><b>Definition:</b> hpdftbl_callback.c:490</div></div>
</div><!-- fragment --><p> In this way it is possible to specify the entire table structure as a text structure that could be stored in a database or as a text file with just the name of the callback functions. However, care must be taken that they are named exactly as they are specified.</p>
<p >The complete table function is shown below and the full example be found in <a class="el" href="tut_ex30_8c-example.html">tut_ex30.c</a></p>
<p ></p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">create_table_ex30(HPDF_Doc pdf_doc, HPDF_Page pdf_page) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_rows = 2;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_cols = 2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">char</span> *table_title = <span class="stringliteral">&quot;tut_ex30: Table with dynamic callbacks&quot;</span>;</div>
<div class="line">    <a class="code hl_struct" href="structhpdftbl.html">hpdftbl_t</a> tbl = <a class="code hl_function" href="hpdftbl_8c.html#aad0f4078a299fcaebde02f16905fe51f">hpdftbl_create_title</a>(num_rows, num_cols, table_title);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#a5f4278417bc42a09aabfca973dbd31ba">hpdftbl_use_labels</a>(tbl, <a class="code hl_define" href="hpdftbl_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#a4a339735a5dae90e6349fddf6c14d152">hpdftbl_use_labelgrid</a>(tbl, <a class="code hl_define" href="hpdftbl_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#ae6e4bfc5f76812623fe3d1cfe8b43395">hpdftbl_set_content_dyncb</a>(tbl, <span class="stringliteral">&quot;cb_content&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#ae64b46d9ef271732d23063f19e6da003">hpdftbl_set_label_dyncb</a>(tbl, <span class="stringliteral">&quot;cb_labels&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8h.html#af89970cb863c640bc1d16951b8a4b7c8">hpdftbl_set_cell_content_dyncb</a>(tbl, 0, 0, <span class="stringliteral">&quot;cb_date&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    HPDF_REAL xpos = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(1);</div>
<div class="line">    HPDF_REAL ypos = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(<a class="code hl_define" href="hpdftbl_8h.html#ac8ef7b15650c2dc4e44a4c2b75359dc2">A4PAGE_HEIGHT_CM</a> - 1);</div>
<div class="line">    HPDF_REAL width = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(12);</div>
<div class="line">    HPDF_REAL height = 0;  <span class="comment">// Calculate height automatically</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Stroke the table to the page</span></div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a>(pdf_doc, pdf_page, tbl, xpos, ypos, width, height);</div>
<div class="line">}</div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue May 31 2022 08:31:58 for libhpdftbl by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
