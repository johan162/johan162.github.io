<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libhpdftbl: Building the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libhpdftbl<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Table construction library for Haru PDF library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__building.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Building the library </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md33"></a>
The short version</h1>
<h2><a class="anchor" id="autotoc_md34"></a>
Compiling the tar ball</h2>
<p >If you downloaded the tar-ball then it should be trivial to build and install if you have the necessary pre-requisites. Just download the tar-ball and do the standard spell:</p>
<div class="fragment"><div class="line">$ tar xzf libhpdftbl-1.0.0.tar.gz</div>
<div class="line">$ cd libhpdf-1.0.0</div>
<div class="line">$ ./configure &amp;&amp; make</div>
<div class="line">$ make install</div>
</div><!-- fragment --><p >If you miss any library the <code>configure</code> process will discover this and tell you what you need to install. This would otherwise compile and install the library in <code>/usr/local</code> subtree. It wil build and install both a static and dynamic library.</p>
<dl class="section note"><dt>Note</dt><dd>By calling <code>./configure -h</code> a list of possible options on how the library should be compiled and installed will be shown.</dd></dl>
<p>Depending on your system this might also be available as a pre-built package for you to install directly via perhaps <code>apt</code>on Linux or <code>brew</code> on OSX.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Pre-requisites</h1>
<dl class="section note"><dt>Note</dt><dd>OSX Package manager: We recommend using <code>brew</code> as the package manager for OSX.</dd></dl>
<p>There are two external libraries required to rebuild libhpdftbl and more importantly use the library with an actual application and these are:</p>
<ol type="1">
<li><b>libhpdf</b> - The Haru PDF library. On OSX this is most easly installed by using the <code>brew</code> OSX package manager. The library is available as <code>libharu</code> as of this writing the latest version is <code>libharu-2.3.0</code> <br  />
</li>
<li><b>iconv</b> - The character encoding conversion library. On OSX &gt; 11.x this is included by default once you have <code>xcode</code> command line tools installed which is basically a pre-requisite required for all development on OSX. <br  />
 *(On really old versions of OSX this was not the case.)*</li>
</ol>
<h2><a class="anchor" id="autotoc_md36"></a>
Different versions of iconv on OSX</h2>
<p >Unfortunately there are two main versions of <code>libiconv</code> readily available for OSX which are incompatible as one uses the prefix "`iconv_*`" and the other "`libiconv_*`" on its exported functions. Compiling <code>libhpdftbl</code> requires the first of these which is the prevelant version and the default on both OSX and Linux.</p>
<p >This is almost exclusivly an issue for those that actively develop on OSX and may have over time installed multiple versions of libraries and as such are aware of these challenges.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
OSX native libiconv</h2>
<p >After installing <code>xcode</code> command line tools on OSX you can assume that a library called <code>/usr/lib/iconv.dylib</code> is available. However, if you actually try to list this library in <code>/usr/lib</code> you will not find it! Still, if you link your code with <code>-liconv</code> it will work as expected. How come? <br  />
</p>
<p >The reason is the way OSX handles different library versions for different OSX SDKs. Since <code>xcode</code> supports developing for different OSX versions the SDK would need to include a complete setup of all <code>*.dylib</code> of the right version for each included version of the SDK. To reduce diskspace all dynamic librares are rolled-up in a dynamic link shared cache for each SDK version. The tool chain (e.g. <code>gcc</code>) have been augmented to be aware of this. Hence there is no need to have libraries in <code>/usr/lib</code>. Instead OSX from v11 and onwards uses the concept of <em>stub libraries</em> <code>*.tbd</code> (tbd stands for "text based description") which are much smaller text files with some meta information about the library used by the tool-chain.</p>
<p >For example for SDK 12.3 the stub for libiconv can be found at</p>
<div class="fragment"><div class="line">/Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/lib/libiconv.tbd</div>
</div><!-- fragment --><p >and the corresponding include header at</p>
<div class="fragment"><div class="line">/Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/include/iconv.h</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
OSX GNU port of libiconv</h2>
<p >If you have happened to install <code>libiconv</code> via the MacPorts you are out of luck and need to change. MacPorts uses the GNU version which uses the prefix "`libiconv_*`" for its exported function and is not compatible since the table library assumes the naming convention of the standard OSX version (after v11)</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Troubleshooting OSX &lt;tt&gt;libiconv&lt;/tt&gt;</h2>
<ol type="1">
<li>Find out all installed versions of <code>libiconv</code> on your installation <br  />
 <pre class="fragment">$&gt; find / -iregex '.*/libiconv.*' 2&gt; /dev/null
</pre> The "`2&gt; /dev/null`" makes sure you don't get a lot of noise "permission denied"</li>
<li>Find out the SDK path that is actively used <br  />
 <pre class="fragment">$&gt; xcrun --show-sdk-path
</pre></li>
<li>Check you <code>PATH</code> variable <br  />
 <pre class="fragment">$&gt; echo $PATH
</pre></li>
</ol>
<h1><a class="anchor" id="autotoc_md40"></a>
Building the library from source</h1>
<p >There are two levels of rebuilding the library</p>
<ol type="1">
<li>Using a build environment to rebuild the library</li>
<li>Rebuilding from a cloned repo and rebuild the build environment</li>
</ol>
<h2><a class="anchor" id="autotoc_md41"></a>
Rebuilding using av existing build environment</h2>
<p >Rebuilding the library using a pre-configured build environment only requires <code>gcc</code> and <code>make</code> together with the standard C/C++ libraries to be installed.</p>
<p >The library source with suitable build-environment is distributed as a tar-ball</p>
<ol type="1">
<li>libhpdf-src-x.y.z.tar.gz</li>
</ol>
<p >This tar-ball include a build environment constructed with the GNU autotools. This means that after downloading the tar-ball you can rebuild the library as so:</p>
<div class="fragment"><div class="line">$&gt; ./configure &amp;&amp; make</div>
<div class="line">... (output from the configuration and build omitted) ...</div>
</div><!-- fragment --><p >and then (optionally) install the library</p>
<div class="fragment"><div class="line">$ make install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md42"></a>
Rebuilding from a cloned repo</h2>
<dl class="section note"><dt>Note</dt><dd>This is for experienced developers!</dd></dl>
<p>The repo does not include any of the generated files as the tar-ball does. This means that the following build tools needs to be setup in order to fully rebuild from a cloned repo.</p>
<ol type="1">
<li>A complete set of GNU compiler chain (or on OSX clang)</li>
<li>the <a href="https://www.wikiwand.com/en/GNU_Autotools">GNU autotools</a> (autoconf, automake, libtool)</li>
<li><a href="https://www.doxygen.nl/manual/index.html">Doxygen</a> in order to rebuild the documentation</li>
</ol>
<p >Since it is completely out of the scope to describe the intricacies of the GNU autotools we will only show what to do assuming this tool chain have already been installed.</p>
<p >To simplify the potentially painful bootstrap of creating a full autotools environment from the cloned repo a utility script that does this is provided in the form of <code><a class="el" href="bootstrap_8sh.html" title="Bootstrap the autotools environment and configure a build setup.">scripts/bootstrap.sh</a></code>. After cloning the repo run (from the <code>libhpdftbl</code> directory)</p>
<div class="fragment"><div class="line">./scripts/bootstrap.sh</div>
</div><!-- fragment --><p >This script will now run <code>autoreconf</code>, <code>automake</code>, <code>glibtoolize</code> as needed in order to create a full build environment. It will also run <code>configure</code> and if everything works as expected the last lines you will see (on OSX) will be</p>
<div class="fragment"><div class="line">...</div>
<div class="line">config.status: executing libtool commands</div>
<div class="line">configure: --------------------------------------------------------------------------------</div>
<div class="line">configure: INSTALLATION SUMMARY:</div>
<div class="line">configure:   - Build configured for OSX.</div>
<div class="line">configure:   - Can rebuild HTML docs with Doxygen.</div>
<div class="line">configure:   - Can also create PDF docs (have LaTeX).</div>
<div class="line">configure:   - Installing to /usr/local</div>
<div class="line">configure: --------------------------------------------------------------------------------</div>
</div><!-- fragment --><p >The final step you need to do is compile the library</p>
<div class="fragment"><div class="line">$&gt; make</div>
</div><!-- fragment --><p >The simplest way to verify that everything works is to execute one of the example programs (in the <code>examples/</code> directory) as so:</p>
<div class="fragment"><div class="line">$&gt; ./examples/example01</div>
<div class="line">Stroking 5 examples.</div>
<div class="line">Sending to file &quot;/tmp/example01.pdf&quot; ...</div>
<div class="line">Done.</div>
</div><!-- fragment --><p >If you would like to install the library make the <code>install</code> target</p>
<div class="fragment"><div class="line">$&gt; make install</div>
</div><!-- fragment --><p >This will install headers and library under "`/usr/local`" (unless the prefix was changed when running the <code>configure</code>)</p>
<h1><a class="anchor" id="autotoc_md43"></a>
Miscellaneous</h1>
<h2><a class="anchor" id="autotoc_md44"></a>
Some notes on Compiling for debugging</h2>
<p >Since the library builds with <code>libtool</code> and this tool will generate a wrapper shell script for each example to load the, not yet installed, library it also means this "executable" shell script cannot directly be used to debug with for example <code>gdb</code>.</p>
<p >The solution for this is to configure the library to only build static libraries which are directly linked with the example binaries and as such can be debugged as usual. This configuration is done with:</p>
<div class="fragment"><div class="line">$&gt; ./configure --enable-debug --disable-shared</div>
</div><!-- fragment --><p >After this all the examples will be statically linked and can be debugged as usual</p>
<p >An alternative way (as recommended in the <a href="https://www.gnu.org/software/libtool/manual/html_node/Debugging-executables.html">libtool manual</a>) is to launch the debugger with:</p>
<div class="fragment"><div class="line">$&gt; libtool --mode=execute gdb &lt;example program&gt;</div>
</div><!-- fragment --><p >As a convenience a script is provided to handle the debug build configuration <a class="el" href="dbgbld_8sh.html" title="Setup a build environment for debugging.">scripts/dbgbld.sh</a></p>
<h2><a class="anchor" id="autotoc_md45"></a>
Some notes on updating the documentation</h2>
<p >By design the documentation is not updated by the default make target in order minimize the build time during development. To rebuild the <em>html</em> documentation build the target</p>
<div class="fragment"><div class="line">$&gt; make html</div>
</div><!-- fragment --><p >and to rebuild the <em>PDF</em> version build the target</p>
<div class="fragment"><div class="line">$&gt; make pdf</div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>There is a shell script <a class="el" href="docupload_8sh_8in.html" title="Upload the generated documentation to the github pages doc site for the author.">scripts/docupload.sh.in</a> that the author (i.e. me!) uses to upload the HTML and PDF documentation to the Github pages of the author. For obvious reason this script will not work for anyone else since it requires write access to the doc repo (through a SSL certificate).</dd></dl>
<h2><a class="anchor" id="autotoc_md46"></a>
Some notes on Windows build</h2>
<p >The source files are suitable augmented to also compile on MS Windows with selective defines. However, since I have no longer access to a Windows system to verify the workings this is left as an exercise to the reader. Hence this should be considered as a best effort</p>
<h2><a class="anchor" id="autotoc_md47"></a>
Some notes on using C or C++ to build</h2>
<p >The source files are also suitable augmented to compile on both a C and a C++ compiler. However, the default build environment is setup for a pure C library build. To add a configuration switch for this would be the sensible way to handle this. This is not done and again, is left as an exercise for the reader. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed May 4 2022 00:18:21 for libhpdftbl by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
