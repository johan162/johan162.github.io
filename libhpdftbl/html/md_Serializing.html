<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libhpdftbl: Serializing table data structures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libhpdftbl<span id="projectnumber">&#160;1.4.0-beta</span>
   </div>
   <div id="projectbrief">Table construction library for Haru PDF library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Serializing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Serializing table data structures </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >A table and heme can be serialized to a JSON structure in a string or file and then read back. The serialization is a complete representation of the table and the theme. However, there is one crucial caveat. If any callback functions is used in the table they can not be serialized since they are represented by the address to the specific function.</p>
<p >However, this is a situation where a dynamic callback function can be used. They way this works is that the callback function is specified by name with one if the dynamic callback functions (e.g. <a class="el" href="hpdftbl_8h.html#ae6e4bfc5f76812623fe3d1cfe8b43395" title="Specify dynamic (late) loading callback content function.">hpdftbl_set_content_dyncb()</a> ). Such a callback will then be serialized as the name of the function.</p>
<p >When the table is de-serialized back into a table using the function <a class="el" href="hpdftbl_8h.html#a38f0d4f834ff880e46a0b4d42af854dc" title="Import a table structure from a serialized table on file.">hpdftbl_load()</a> the functions must be available in some linked images to be resolved.</p>
<p >Please note that the table needs to be stroked (via for example <a class="el" href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763" title="Stroke the table.">hpdftbl_stroke()</a>) before it can be serialized since a number of calculations of internal positions are not calculated until one of the stroke functions are called.</p>
<dl class="section note"><dt>Note</dt><dd>Some discussion can be held whether Yaml or Json should be used as serializing format. The reason for choosing Json was primary based on a) easier to manually manipulate a file where invisible spaces doesn't have grammatical meaning. b) existence of efficient libraries</dd></dl>
<h1><a class="anchor" id="autotoc_md47"></a>
Serializing a table to file</h1>
<p >After the table have been stroked it can be saved to a file as the following snippet shows.</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a>(pdf_doc, pdf_page, tbl, xpos, ypos, width, height);</div>
<div class="line"><a class="code hl_function" href="hpdftbl_8h.html#a790b63a1f8239c077a5dc2ffb4ce38d2">hpdftbl_dump</a>(tbl, <span class="stringliteral">&quot;table_serialized.json&quot;</span>);</div>
<div class="ttc" id="ahpdftbl_8c_html_ae07ffb136a6e6fd7311afc0acf7cf763"><div class="ttname"><a href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a></div><div class="ttdeci">int hpdftbl_stroke(HPDF_Doc pdf, const HPDF_Page page, hpdftbl_t t, const HPDF_REAL xpos, const HPDF_REAL ypos, const HPDF_REAL width, HPDF_REAL height)</div><div class="ttdoc">Stroke the table.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:1676</div></div>
<div class="ttc" id="ahpdftbl_8h_html_a790b63a1f8239c077a5dc2ffb4ce38d2"><div class="ttname"><a href="hpdftbl_8h.html#a790b63a1f8239c077a5dc2ffb4ce38d2">hpdftbl_dump</a></div><div class="ttdeci">int hpdftbl_dump(hpdftbl_t tbl, char *filename)</div><div class="ttdoc">Serialize a table structure as a JSON file.</div><div class="ttdef"><b>Definition:</b> hpdftbl_dump.c:190</div></div>
</div><!-- fragment --><p >The snippet above will write a JSON representation of the table to the file <code>table_serialized.json</code>. The full path is given and it is an error if some intermediate directory does not exist.</p>
<p >An example of a json file can be found here: <a href="tut_ex40_8json-example.html">tut_ex40.json</a> <br  />
</p>
<h1><a class="anchor" id="autotoc_md48"></a>
Serializing a table to a string buffer</h1>
<p >This is done with the <a class="el" href="hpdftbl_8h.html#accf9924a01142a9c36af0f32a205a6ad" title="Serialize a table structure to a string buffer.">hpdftbl_dumps()</a> function as the following example shows.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> buffsize=100*1024;</div>
<div class="line"><span class="keywordtype">char</span> *sbuff=calloc(buffsize, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="hpdftbl_8h.html#accf9924a01142a9c36af0f32a205a6ad">hpdftbl_dumps</a>(theme, sbuff, buffsize);</div>
<div class="line">fprintf(stdout,<span class="stringliteral">&quot;%s\n&quot;</span>,sbuff);</div>
<div class="line">free(sbuff);</div>
<div class="ttc" id="ahpdftbl_8h_html_accf9924a01142a9c36af0f32a205a6ad"><div class="ttname"><a href="hpdftbl_8h.html#accf9924a01142a9c36af0f32a205a6ad">hpdftbl_dumps</a></div><div class="ttdeci">int hpdftbl_dumps(hpdftbl_t tbl, char *buff, size_t buffsize)</div><div class="ttdoc">Serialize a table structure to a string buffer.</div><div class="ttdef"><b>Definition:</b> hpdftbl_dump.c:218</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md49"></a>
Reading back a serialized table</h1>
<p >The following snippet shows how the previously serialzed table can be read back and stroked to a PDF file</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>( 0 == <a class="code hl_function" href="hpdftbl_8h.html#a38f0d4f834ff880e46a0b4d42af854dc">hpdftbl_load</a>(&amp;tbl, <span class="stringliteral">&quot;table_serialized.json&quot;</span>)  ) {</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#a9adfb73b5bf0d60c683cc04da1c40c70">hpdftbl_stroke_pos</a>(pdf_doc, pdf_page, tbl);</div>
<div class="line">}</div>
<div class="ttc" id="ahpdftbl_8c_html_a9adfb73b5bf0d60c683cc04da1c40c70"><div class="ttname"><a href="hpdftbl_8c.html#a9adfb73b5bf0d60c683cc04da1c40c70">hpdftbl_stroke_pos</a></div><div class="ttdeci">int hpdftbl_stroke_pos(HPDF_Doc pdf, const HPDF_Page page, hpdftbl_t t)</div><div class="ttdoc">Stroke the table using the already specified size and position within the table.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:1648</div></div>
<div class="ttc" id="ahpdftbl_8h_html_a38f0d4f834ff880e46a0b4d42af854dc"><div class="ttname"><a href="hpdftbl_8h.html#a38f0d4f834ff880e46a0b4d42af854dc">hpdftbl_load</a></div><div class="ttdeci">int hpdftbl_load(hpdftbl_t tbl, char *filename)</div><div class="ttdoc">Import a table structure from a serialized table on file.</div><div class="ttdef"><b>Definition:</b> hpdftbl_load.c:330</div></div>
</div><!-- fragment --><p> It can be noted that we use the alternative stroke function <a class="el" href="hpdftbl_8c.html#a9adfb73b5bf0d60c683cc04da1c40c70" title="Stroke the table using the already specified size and position within the table.">hpdftbl_stroke_pos()</a> which is used to stroke a table when the position is set within the table itself and don't need to be specified as arguments to the stroke functio as is necessary with <a class="el" href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763" title="Stroke the table.">hpdftbl_stroke()</a>.</p>
<dl class="section note"><dt>Note</dt><dd>An error check should always be performed when reading back a table since it is possible that the data have been corrupted.</dd></dl>
<h1><a class="anchor" id="autotoc_md50"></a>
Serializing a theme to a file</h1>
<p >A theme can be serialized with the help of <a class="el" href="hpdftbl_8h.html#a1ab6b96f3b440ed439135f3715dce2a5" title="Serialize the specified theme structure to a named file.">hpdftbl_theme_dump()</a> as the following example that serializes the default theme</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structhpdftbl__theme.html">hpdftbl_theme_t</a> *theme = <a class="code hl_function" href="hpdftbl_8h.html#a2089087e554335e1b3f5f5940613b9aa">hpdftbl_get_default_theme</a>();</div>
<div class="line"><a class="code hl_function" href="hpdftbl_8h.html#a1ab6b96f3b440ed439135f3715dce2a5">hpdftbl_theme_dump</a>(theme,<span class="stringliteral">&quot;out/default_theme.json&quot;</span>);</div>
<div class="ttc" id="ahpdftbl_8h_html_a1ab6b96f3b440ed439135f3715dce2a5"><div class="ttname"><a href="hpdftbl_8h.html#a1ab6b96f3b440ed439135f3715dce2a5">hpdftbl_theme_dump</a></div><div class="ttdeci">int hpdftbl_theme_dump(hpdftbl_theme_t *theme, char *filename)</div><div class="ttdoc">Serialize the specified theme structure to a named file.</div><div class="ttdef"><b>Definition:</b> hpdftbl_dump.c:108</div></div>
<div class="ttc" id="ahpdftbl_8h_html_a2089087e554335e1b3f5f5940613b9aa"><div class="ttname"><a href="hpdftbl_8h.html#a2089087e554335e1b3f5f5940613b9aa">hpdftbl_get_default_theme</a></div><div class="ttdeci">hpdftbl_theme_t * hpdftbl_get_default_theme(void)</div><div class="ttdoc">Return the default theme.</div><div class="ttdef"><b>Definition:</b> hpdftbl_theme.c:259</div></div>
<div class="ttc" id="astructhpdftbl__theme_html"><div class="ttname"><a href="structhpdftbl__theme.html">hpdftbl_theme</a></div><div class="ttdoc">Define a set of styles into a table theme.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:635</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md51"></a>
Serializing a theme to a string buffer</h1>
<p >This is done with the <a class="el" href="hpdftbl_8h.html#abdf4b69579ce4c5b33a88b287f3c7e6b" title="Serialize theme structure to a string buffer.">hpdftbl_theme_dumps()</a> function as the following example shows</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> buffsize=2*1024;</div>
<div class="line"><span class="keywordtype">char</span> *sbuff=calloc(buffsize, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="structhpdftbl__theme.html">hpdftbl_theme_t</a> *theme = <a class="code hl_function" href="hpdftbl_8h.html#a2089087e554335e1b3f5f5940613b9aa">hpdftbl_get_default_theme</a>();</div>
<div class="line"><a class="code hl_function" href="hpdftbl_8h.html#abdf4b69579ce4c5b33a88b287f3c7e6b">hpdftbl_theme_dumps</a>(theme, sbuff, buffsize);</div>
<div class="line">fprintf(stdout,<span class="stringliteral">&quot;%s\n&quot;</span>,sbuff);</div>
<div class="line">free(sbuff);</div>
<div class="ttc" id="ahpdftbl_8h_html_abdf4b69579ce4c5b33a88b287f3c7e6b"><div class="ttname"><a href="hpdftbl_8h.html#abdf4b69579ce4c5b33a88b287f3c7e6b">hpdftbl_theme_dumps</a></div><div class="ttdeci">int hpdftbl_theme_dumps(hpdftbl_theme_t *theme, char *buff, size_t buffsize)</div><div class="ttdoc">Serialize theme structure to a string buffer.</div><div class="ttdef"><b>Definition:</b> hpdftbl_dump.c:135</div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md52"></a>
Reading back a serialized theme</h1>
<p >A theme can be read back with the <a class="el" href="hpdftbl_8h.html#ae863a0b0888380c6ce6047f6810b641d" title="Read a theme from a previous serialized theme from a named file.">hpdftbl_theme_load()</a> and <a class="el" href="hpdftbl_8h.html#ab25c12d9b78abd1a07969c792c0bcce4" title="Load theme from a serialized string. This is the invert function of hpdftbl_theme_dumps().">hpdftbl_theme_loads()</a> functions.</p>
<h1><a class="anchor" id="autotoc_md53"></a>
Example of reading back serialized theme and table</h1>
<p >The following shows an example of creating a table with a theme where both theme and table are read back from previous serialized representation.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structhpdftbl.html">hpdftbl_t</a> tbl = calloc(1, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code hl_struct" href="structhpdftbl.html">hpdftbl</a>));</div>
<div class="line"><a class="code hl_struct" href="structhpdftbl__theme.html">hpdftbl_theme_t</a> theme;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span>(0 == <a class="code hl_function" href="hpdftbl_8h.html#a38f0d4f834ff880e46a0b4d42af854dc">hpdftbl_load</a>(tbl, <span class="stringliteral">&quot;tests/tut_ex41.json&quot;</span>)  ) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(0 == <a class="code hl_function" href="hpdftbl_8h.html#ae863a0b0888380c6ce6047f6810b641d">hpdftbl_theme_load</a>(&amp;theme, <span class="stringliteral">&quot;tests/tut41_theme.json&quot;</span>)) {</div>
<div class="line">        <a class="code hl_function" href="hpdftbl_8h.html#aa69c87be9c690ac9f3dc8a9ecf748f36">hpdftbl_apply_theme</a>(tbl, &amp;theme);</div>
<div class="line">        <a class="code hl_function" href="hpdftbl_8c.html#a9adfb73b5bf0d60c683cc04da1c40c70">hpdftbl_stroke_pos</a>(pdf_doc, pdf_page, tbl);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        fprintf(stderr,<span class="stringliteral">&quot;%s\n&quot;</span>,<span class="stringliteral">&quot;Failed to load &#39;tests/default_theme.json&#39;\n&quot;</span>);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    fprintf(stderr,<span class="stringliteral">&quot;%s\n&quot;</span>,<span class="stringliteral">&quot;Failed to load &#39;tests/tut_ex41.json&#39;\n&quot;</span>);</div>
<div class="line">    exit(1);</div>
<div class="line">}</div>
<div class="ttc" id="ahpdftbl_8h_html_aa69c87be9c690ac9f3dc8a9ecf748f36"><div class="ttname"><a href="hpdftbl_8h.html#aa69c87be9c690ac9f3dc8a9ecf748f36">hpdftbl_apply_theme</a></div><div class="ttdeci">int hpdftbl_apply_theme(hpdftbl_t t, hpdftbl_theme_t *theme)</div><div class="ttdoc">Apply a specified theme to a table.</div><div class="ttdef"><b>Definition:</b> hpdftbl_theme.c:177</div></div>
<div class="ttc" id="ahpdftbl_8h_html_ae863a0b0888380c6ce6047f6810b641d"><div class="ttname"><a href="hpdftbl_8h.html#ae863a0b0888380c6ce6047f6810b641d">hpdftbl_theme_load</a></div><div class="ttdeci">int hpdftbl_theme_load(hpdftbl_theme_t *tbl, char *filename)</div><div class="ttdoc">Read a theme from a previous serialized theme from a named file.</div><div class="ttdef"><b>Definition:</b> hpdftbl_load.c:282</div></div>
<div class="ttc" id="astructhpdftbl_html"><div class="ttname"><a href="structhpdftbl.html">hpdftbl</a></div><div class="ttdoc">Core table handle.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:470</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 29 2022 08:16:58 for libhpdftbl by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
