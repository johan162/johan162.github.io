<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libhpdftbl: Building the library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libhpdftbl<span id="projectnumber">&#160;1.4.0</span>
   </div>
   <div id="projectbrief">Table construction library for Haru PDF library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_Building.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Building the library </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md10"></a>
The short version; TL; DR</h1>
<p ><em>For the long version see</em> <a class="el" href="md_Building.html#building-from-source">Building from source</a></p>
<p >If the necessary <a class="el" href="md_Building.html#pre-req">pre-requisites</a> are fulfilled the distributed tar-ball can be built with:</p>
<div class="fragment"><div class="line">$ tar xzf libhpdftbl-&lt;version&gt;.tar.gz</div>
<div class="line">$ cd libhpdftbl-&lt;version&gt;</div>
<div class="line">$ ./configure &amp;&amp; make</div>
</div><!-- fragment --><p> If any libraries are missing the <code>configure</code> process will discover this and tell what needs to be installed. Use <code>./configure -h</code> to see a list of possible options for configuring the build.</p>
<p >To then verify the build run</p>
<div class="fragment"><div class="line">$ make check</div>
</div><!-- fragment --><p> which will execute all the unit-tests in the library. If all tests pass a <em>Success!</em> message can bee seen at the end of all listed tests. The library can then be installed with</p>
<div class="fragment"><div class="line">$ make install</div>
</div><!-- fragment --><p >If the install succeeds this will, by default, install the library in the <code>/usr/local</code> subtree, both a static and dynamic version of the library will by default be installed.</p>
<dl class="section note"><dt>Note</dt><dd>What directory to install to can be adjusted by using the <code>--prefix</code> argument when configuring the build.</dd></dl>
<h1><a class="anchor" id="pre-req"></a>
Pre-requisites</h1>
<p >There are two mandatory and one semi-otional external library required to fully build the libhpdftbl:</p>
<ol type="1">
<li><b>libhpdf</b> - The Haru PDF library. On OSX this is most easily installed by using the <code>brew</code> OSX package manager. The library is available as <code>libharu</code> as of this writing the latest version is <code>libharu-2.3.0</code> <br  />
</li>
<li><b>iconv</b> - The character encoding conversion library. On OSX &gt; 11.x this is included by default once you have <code>xcode</code> command line tools installed which is basically a pre-requisite required for all development on OSX. <em>On ancient versions of OSX this was not the case.</em></li>
<li><b>libjansson</b> - Library to parse JSON files. Needed to enable table serialization to- and from JSON format. <em>Note:</em> This can be omitted but then no serialization functions will be available in the library.</li>
</ol>
<h2><a class="anchor" id="autotoc_md11"></a>
Different versions of iconv on OSX</h2>
<dl class="section note"><dt>Note</dt><dd>OSX Package manager: We recommend using <code>brew</code> as the package manager for OSX.</dd></dl>
<p>Unfortunately there are two different (and incompatible) versions of <code>libiconv</code> readily available for OSX. One library that uses the prefix <code>iconv_*</code> and the other <code>libiconv_*</code> on its exported functions. Compiling <code>libhpdftbl</code> requires the first of these which is the prevalent version and the default on both OSX and Linux.</p>
<p >This is almost exclusively an issue for those that actively develop on OSX and may have over time installed multiple versions of libraries and as such are aware of these challenges.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
OSX native libiconv</h2>
<p >After installing <code>xcode</code> command line tools on OSXit is safe to assume that a library called <code>/usr/lib/iconv.dylib</code> is available.</p>
<p >However, if one tries to list this library in <code>/usr/lib</code> there will not be a <code>libiconv.dylib</code>. Still, if the code is linked with <code>-liconv</code> it will work as expected. How come? <br  />
</p>
<p >The reason is the way OSX handles different library versions for different OSX SDKs. Since <code>xcode</code> supports developing for different OSX versions the SDK would need to include a complete setup of all <code>*.dylib</code> of the right version for each included version of the SDK. To reduce diskspace all dynamic libraries are rolled-up in a dynamic link shared cache for each SDK version. The tool chain (e.g. <code>clang</code>) have been augmented to be aware of this. Hence, there is no need to have libraries in <code>/usr/lib</code>. Instead, OSX from v11 and onwards uses the concept of <em>stub libraries</em> with suffix <code>*.tbd</code> for each supported SDK version (tbd stands for "text based description"). They are small text files with meta information about the library used by the tool-chain.</p>
<p >For example for SDK 12.3 the stub for libiconv can be found at</p>
<div class="fragment"><div class="line">/Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/lib/libiconv.tbd</div>
</div><!-- fragment --><p >and the corresponding include header is located at</p>
<div class="fragment"><div class="line">/Library/Developer/CommandLineTools/SDKs/MacOSX12.3.sdk/usr/include/iconv.h</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
OSX GNU port of libiconv</h2>
<p >If you have happened to install <code>libiconv</code> via the MacPorts you are out of luck and need to change. MacPorts uses the GNU version which uses the prefix "`libiconv_*`" for its exported function and is not compatible since the table library assumes the naming convention of the standard OSX version (after v11)</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Troubleshooting OSX &lt;tt&gt;libiconv&lt;/tt&gt;</h2>
<p >If the build complains about <code>libiconv</code> the following steps could be take to try to track down the problem:</p>
<ol type="1">
<li>Find out all installed versions of <code>libiconv</code> on your machine <br  />
 <pre class="fragment">$&gt; find / -iregex '.*/libiconv.*' 2&gt; /dev/null
</pre> The "`2&gt; /dev/null`" makes sure you don't get a lot of noise with "permission denied"</li>
<li>Find out the SDK path that is actively used <br  />
 <pre class="fragment">$&gt; xcrun --show-sdk-path
</pre></li>
<li>Check you <code>PATH</code> variable <br  />
 <pre class="fragment">$&gt; echo $PATH
</pre></li>
</ol>
<h1><a class="anchor" id="building-from-source"></a>
Building the library from source</h1>
<p >There are two levels of rebuilding the library that we will discuss</p>
<ol type="1">
<li>Using a build environment to rebuild the library (i.e. building from the supplied tar-ball)</li>
<li>Rebuilding from a cloned repo and rebuild the build environment from scratch. As a principle no generated files are stored in the repo.</li>
</ol>
<h2><a class="anchor" id="autotoc_md15"></a>
Rebuilding using av existing build environment</h2>
<p >Rebuilding the library using a pre-configured build environment requires <code>gcc</code> ( or <code>clang</code>) and <code>make</code> together with the standard C/C++ libraries to build the library.</p>
<p >The library source with suitable build-environment is distributed as a tar-ball</p>
<ol type="1">
<li><code>libhpdftbl-x.y.z.tar.gz</code></li>
</ol>
<p >This tar-ball includes a build environment constructed with the GNU autotools. This means that after downloading the tar-ball you can rebuild the library as so:</p>
<div class="fragment"><div class="line">$ tar xzf libhpdftbl-x.y.z.tar.gz</div>
<div class="line">$ cd libhpdf-x.y.z</div>
<div class="line">$ ./configure &amp;&amp; make</div>
<div class="line">... (output from the configuration and build omitted) ...</div>
</div><!-- fragment --><p >and then (optionally) install the library with</p>
<div class="fragment"><div class="line">$ make install</div>
</div><!-- fragment --><p >By default, the library will install under the <code>/usr/local</code> but that can be adjusted by using the <code>--prefix</code> parameter to <code>configure</code>. For example</p>
<div class="fragment"><div class="line">$ tar xzf libhpdftbl-1.0.0.tar.gz</div>
<div class="line">$ cd libhpdf-1.0.0</div>
<div class="line">$ ./configure --prefix=/usr &amp;&amp; make</div>
<div class="line">... (output from the configuration and build omitted) ...</div>
</div><!-- fragment --><p >Please refer to <code>configure -h</code> for other possible configurations. As a shortcut two utility scripts are included that give some extra <code>CFLAGS</code> flags to either compile the library for production use <code>./scripts/stdbld.sh</code> or for debugging <code>./scripts/dbgbld.sh</code> (See <a class="el" href="md_Building.html#lib-debug">Some notes on Debugging</a>)</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Rebuilding from a cloned repo</h2>
<dl class="section note"><dt>Note</dt><dd>This is for experienced developers!</dd></dl>
<p>The repo does not include any of the generated files as the tar-ball does. This means that the following build tools needs to be installed in order to fully rebuild from a cloned repo.</p>
<ol type="1">
<li>A complete set of GNU compiler chain (or on OSX clang)</li>
<li><a href="https://www.wikiwand.com/en/GNU_Autotools">GNU autotools</a> (autoconf, automake, libtool)</li>
<li><a href="https://www.doxygen.nl/manual/index.html">Doxygen</a> in order to rebuild the documentation.</li>
</ol>
<p >Since it is completely out of the scope to describe the intricacies of the GNU autotools we will only show what to do assuming this tool chain have already been installed.</p>
<p >To simplify the bootstrapping necessary to create a full autotools environment from the cloned repo a utility script that does this is provided in the form of <code>./scripts/bootstrap.sh</code>. After cloning the repo run (from the <code>libhpdftbl</code> top directory)</p>
<div class="fragment"><div class="line">$ ./scripts/bootstrap.sh</div>
</div><!-- fragment --><p >This script will now run <code>autoreconf</code>, <code>automake</code>, <code>glibtoolize</code> as needed in order to create a full build environment. It will also run <code>configure</code> and if everything works as expected the last lines you will see (on OSX) will be</p>
<div class="fragment"><div class="line">...</div>
<div class="line">config.status: executing libtool commands</div>
<div class="line">configure: --------------------------------------------------------------------------------</div>
<div class="line">configure: INSTALLATION SUMMARY:</div>
<div class="line">configure:   - Build configured for OSX.</div>
<div class="line">configure:   - Can rebuild HTML docs with Doxygen.</div>
<div class="line">configure:   - Can also create PDF docs (have LaTeX).</div>
<div class="line">configure:   - Installing to /usr/local</div>
<div class="line">configure: --------------------------------------------------------------------------------</div>
</div><!-- fragment --><p >and then to compile the library with</p>
<div class="fragment"><div class="line">$ make</div>
</div><!-- fragment --><p >The simplest way to verify that everything works is to run the built-in unit/integration tests</p>
<div class="fragment"><div class="line">$ make check</div>
<div class="line">Info: PASS: tut_ex01</div>
<div class="line">Info: PASS: tut_ex02</div>
<div class="line">&lt;omitted ...&gt;</div>
<div class="line">Info: PASS: tut_ex20</div>
<div class="line">Info: =================================</div>
<div class="line">Info: SUCCESS! 20/20 tests passed.</div>
<div class="line">Info: =================================</div>
</div><!-- fragment --><p >To install the library use</p>
<div class="fragment"><div class="line">$&gt; make install</div>
</div><!-- fragment --><p >This will install headers and library under <code>/usr/local</code> (unless the prefix was changed when running the <code>configure</code>)</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Miscellaneous</h1>
<h2><a class="anchor" id="lib-debug"></a>
Some notes on Compiling for debugging</h2>
<p >Since the library builds with <code>libtool</code> and this tool will generate a wrapper shell script for each example to load the, not yet installed, library it also means this "executable" shell script cannot directly be used to debug with for example <code>gdb</code>.</p>
<p >The solution for this is to configure the library to only build static libraries which are directly linked with the example binaries and as such can be debugged as usual. It is also a good idea to disable optimization during debugging to make the source better follow the execution while stepping through the code. This configuration is done with:</p>
<div class="fragment"><div class="line">$&gt; ./configure --disable-shared CFLAGS=&quot;-O0 -ggdb&quot;</div>
</div><!-- fragment --><p >After this all the examples will be statically linked and can be debugged as usual</p>
<p >An alternative way (as recommended in the <a href="https://www.gnu.org/software/libtool/manual/html_node/Debugging-executables.html">libtool manual</a>) is to launch the debugger with:</p>
<div class="fragment"><div class="line">$&gt; libtool --mode=execute gdb &lt;example program&gt;</div>
</div><!-- fragment --><p >This will run the <code>gdb</code> debugger from command line. For debugging from within a IDE (like Netbeans, Clion, etc.) use the static library method.</p>
<p >As a convenience a script is provided to handle the debug build configuration <code><a class="el" href="dbgbld_8sh.html" title="Setup a build environment for debugging.">scripts/dbgbld.sh</a></code></p>
<h2><a class="anchor" id="autotoc_md19"></a>
Some notes on updating the documentation</h2>
<p >By design the documentation is not updated by the default make target in order minimize the build time during development. To rebuild the <em>html</em> documentation build the target</p>
<div class="fragment"><div class="line">$&gt; make html</div>
</div><!-- fragment --><p >and to rebuild the <em>PDF</em> version build (assuming you have LaTeX installed)</p>
<div class="fragment"><div class="line">$&gt; make pdf</div>
</div><!-- fragment --><p >The resulting documentations are stored under <code>docs/out/html</code> and <code>docs/out/latex/refman.pdf</code></p>
<dl class="section warning"><dt>Warning</dt><dd>There is a shell script <code>scripts/docupload.sh.in</code> that the author (i.e. me!) uses to upload the HTML and PDF documentation to the GitHub pages of the author. For obvious reason this script will not work for anyone else since it requires write access to the doc repo (through an SSL certificate).</dd></dl>
<h2><a class="anchor" id="autotoc_md20"></a>
Some notes on Windows build</h2>
<p >The source files are suitable augmented to also compile on MS Windows with selective defines. However, this is on a best effort basis since I have no longer access to a Windows system to verify the workings. So, basically there is expected to some minor configuration issues when building on windows. Patches are welcome!</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Some notes on using C or C++ to build</h2>
<p >The source files are also suitable augmented to compile on both a C and a C++ compiler. However, the default build environment is set up for a pure C library build. To add a configuration switch for this would be the sensible way to handle this. This is not done and again, is left as an exercise for the reader. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue May 31 2022 08:31:58 for libhpdftbl by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
