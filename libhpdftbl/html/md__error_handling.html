<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libhpdftbl: Error handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libhpdftbl<span id="projectnumber">&#160;1.0.1-wip</span>
   </div>
   <div id="projectbrief">Table construction library for Haru PDF library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__error_handling.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Error handling </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >All library function will return an error code &lt; 0 and also set a global variable to a specific error code that can later be read by an error handler. In order to translate the error to a human-readable string the function <code><a class="el" href="hpdftbl_8c.html#a6ff78fe6264c00147dd5f074629230d1" title="Return last error code.">hpdftbl_get_last_errcode()</a></code> can be used as the following error handling snippet examplified by a call to <code><a class="el" href="hpdftbl_8c.html#abd26b96fb00eb1a30862ee67f9328cc3" title="Set column width as percentage of overall table width.">hpdftbl_set_colwidth_percent()</a></code></p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>( <a class="code hl_function" href="hpdftbl_8c.html#abd26b96fb00eb1a30862ee67f9328cc3">hpdftbl_set_colwidth_percent</a>(tbl, 5, 110) ) {</div>
<div class="line">    <span class="comment">// This is an error</span></div>
<div class="line">    <span class="keywordtype">char</span> *err_str;</div>
<div class="line">    <span class="keywordtype">int</span> err_code, r, c;</div>
<div class="line">    err_code=<a class="code hl_function" href="hpdftbl_8c.html#a6ff78fe6264c00147dd5f074629230d1">hpdftbl_get_last_errcode</a>(&amp;err_str, &amp;r, &amp;c);</div>
<div class="line">    <span class="keywordflow">if</span>( err_code ) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;*ERROR*: \&quot;%s\&quot; at cell (%d, %d)&quot;</span>,err_str,r,c);</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="ahpdftbl_8c_html_a6ff78fe6264c00147dd5f074629230d1"><div class="ttname"><a href="hpdftbl_8c.html#a6ff78fe6264c00147dd5f074629230d1">hpdftbl_get_last_errcode</a></div><div class="ttdeci">int hpdftbl_get_last_errcode(const char **errstr, int *row, int *col)</div><div class="ttdoc">Return last error code.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:255</div></div>
<div class="ttc" id="ahpdftbl_8c_html_abd26b96fb00eb1a30862ee67f9328cc3"><div class="ttname"><a href="hpdftbl_8c.html#abd26b96fb00eb1a30862ee67f9328cc3">hpdftbl_set_colwidth_percent</a></div><div class="ttdeci">int hpdftbl_set_colwidth_percent(hpdftbl_t t, size_t c, float w)</div><div class="ttdoc">Set column width as percentage of overall table width.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:564</div></div>
</div><!-- fragment --><p >As can be seen from the snippet above it would yield quite longwinding error handling if one where to check every single library call. Instead, there is the option of installing an error handler that would be called in the event of an error.</p>
<p >The table error handle has the signature</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_typedef" href="hpdftbl_8h.html#a21dab8b38ee079b1927e54c888e3a384">hpdftbl_error_handler_t</a>)(<a class="code hl_struct" href="structhpdftbl.html">hpdftbl_t</a> tbl, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> err)</div>
<div class="ttc" id="ahpdftbl_8h_html_a21dab8b38ee079b1927e54c888e3a384"><div class="ttname"><a href="hpdftbl_8h.html#a21dab8b38ee079b1927e54c888e3a384">hpdftbl_error_handler_t</a></div><div class="ttdeci">void(* hpdftbl_error_handler_t)(hpdftbl_t, int, int, int)</div><div class="ttdoc">TYpe for error handler function.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:595</div></div>
<div class="ttc" id="astructhpdftbl_html"><div class="ttname"><a href="structhpdftbl.html">hpdftbl</a></div><div class="ttdoc">Core table handle.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:391</div></div>
</div><!-- fragment --><p >Where the arguments are</p>
<ol type="1">
<li><code>tbl</code> The table in where the error happened. <b>Note</b> This might be <code>NULLÂ´ since not all errors happen within the context of a table 2.</code>r<code>,</code>c<code>The row and column if the error happens in a specified cell, otherwise these will be (-1,-1) 3.</code>err` The internal error code. This si always a negative number.</li>
</ol>
<p >The error handler is set with the <code><a class="el" href="hpdftbl_8c.html#adab6f6dae9a3d74906eba7e4e92c0ea4" title="Specify errhandler for the table routines.">hpdftbl_set_errhandler()</a></code> method. An example of a very simple error handle is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">my_table_error_handler(<a class="code hl_struct" href="structhpdftbl.html">hpdftbl_t</a> t, <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">int</span> err) {</div>
<div class="line">    <span class="keywordflow">if</span>( r&gt;-1 &amp;&amp; c&gt;-1 ) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;*** Table Error: [%d] \&quot;%s\&quot; at cell (%d, %d)\n&quot;</span>, err, <a class="code hl_function" href="hpdftbl_8c.html#acd0ca8ffa21fef59ce1d253dab6ca160">hpdftbl_get_errstr</a>(err), r, c);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;*** Table Error: [%d] \&quot;%s\&quot; \n&quot;</span>, err, <a class="code hl_function" href="hpdftbl_8c.html#acd0ca8ffa21fef59ce1d253dab6ca160">hpdftbl_get_errstr</a>(err));</div>
<div class="line">    }</div>
<div class="line">    exit(1);</div>
<div class="line">}</div>
<div class="ttc" id="ahpdftbl_8c_html_acd0ca8ffa21fef59ce1d253dab6ca160"><div class="ttname"><a href="hpdftbl_8c.html#acd0ca8ffa21fef59ce1d253dab6ca160">hpdftbl_get_errstr</a></div><div class="ttdeci">const char * hpdftbl_get_errstr(int err)</div><div class="ttdoc">Translate a table error code to a human readable string.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:196</div></div>
</div><!-- fragment --><p> In the above error handler we have made use of the utility function <code><a class="el" href="hpdftbl_8c.html#acd0ca8ffa21fef59ce1d253dab6ca160" title="Translate a table error code to a human readable string.">hpdftbl_get_errstr()</a></code> that translates the internal error code to a human-readable string.</p>
<p >In fact this exact error handler is available as a convenience in the library under the name <code>hpdftbl_default_table_error_handler</code> so to use this trivial error handler just add the following line to your code</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="hpdftbl_8c.html#adab6f6dae9a3d74906eba7e4e92c0ea4">hpdftbl_set_errhandler</a>(<a class="code hl_function" href="hpdftbl_8c.html#a2ff1cca64859bc1acea1c323c5972f3d">hpdftbl_default_table_error_handler</a>);</div>
<div class="ttc" id="ahpdftbl_8c_html_a2ff1cca64859bc1acea1c323c5972f3d"><div class="ttname"><a href="hpdftbl_8c.html#a2ff1cca64859bc1acea1c323c5972f3d">hpdftbl_default_table_error_handler</a></div><div class="ttdeci">void hpdftbl_default_table_error_handler(hpdftbl_t t, int r, int c, int err)</div><div class="ttdoc">A basic default table error handler.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:227</div></div>
<div class="ttc" id="ahpdftbl_8c_html_adab6f6dae9a3d74906eba7e4e92c0ea4"><div class="ttname"><a href="hpdftbl_8c.html#adab6f6dae9a3d74906eba7e4e92c0ea4">hpdftbl_set_errhandler</a></div><div class="ttdeci">hpdftbl_error_handler_t hpdftbl_set_errhandler(hpdftbl_error_handler_t err_handler)</div><div class="ttdoc">Specify errhandler for the table routines.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:286</div></div>
</div><!-- fragment --><p >More advanced error handler must be written for thr particular application they are to be used in.</p>
<dl class="section note"><dt>Note</dt><dd>A common way to extend the error handling is to log the errors to syslog. When the library is used on OSX from 11.0 and onwards it should be rememberd that OSX is broken by design as far as syslog logging is concerned. Apple in its wisdom introduced "Unified logging" which breaks the <code>syslog()</code> function and no logging is ever produced in the filesystem directly (i.e. to <code>/var/log/system.log</code>). <br  />
 Instead the only way to view the logs is by using the utility <code>log</code>. So in order to view the log from a particular application the following command has to be given <br  />
 &lsquo;log stream --info --debug --predicate 'sender == "APPLICATION_NAME"&rsquo; &ndash;style syslog`</dd></dl>
<h1><a class="anchor" id="autotoc_md18"></a>
Translating HPDF error codes</h1>
<p >The standard error handler for the plain HPDF library is specified when a new document is created, for example as'</p>
<div class="fragment"><div class="line">...</div>
<div class="line">pdf_doc = HPDF_New(error_handler, NULL);</div>
<div class="line">HPDF_SetCompressionMode(pdf_doc, HPDF_COMP_ALL);</div>
<div class="line">...</div>
</div><!-- fragment --><p >The error handler signature is defined by Haru PDF library as</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> error_handler(HPDF_STATUS error_no, HPDF_STATUS detail_no, <span class="keywordtype">void</span> *user_data);</div>
</div><!-- fragment --><p >It is then up to the application code to decide how to handle the error. To simplify the handling of core HPDF error the library also offer a convenience function to translate the Haru library error code into a human-readable string. This function is</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a class="code hl_function" href="hpdftbl_8h.html#a926e8b332d44d03402264d039f293cb7">hpdftbl_hpdf_get_errstr</a>(<span class="keyword">const</span> HPDF_STATUS err_code) </div>
<div class="ttc" id="ahpdftbl_8h_html_a926e8b332d44d03402264d039f293cb7"><div class="ttname"><a href="hpdftbl_8h.html#a926e8b332d44d03402264d039f293cb7">hpdftbl_hpdf_get_errstr</a></div><div class="ttdeci">const char * hpdftbl_hpdf_get_errstr(HPDF_STATUS err_code)</div><div class="ttdoc">Function to return a human readable error string for an error code from Core HPDF library.</div><div class="ttdef"><b>Definition:</b> hpdftbl_errstr.c:178</div></div>
</div><!-- fragment --><p >and is used in the error handler in all the examples.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Example of setting up error handler</h1>
<p >The following table creation code have a deliberate error in that it tries to assign a total column width of more than 100% which of course isn't possible.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span></div>
<div class="line">create_table_ex10(HPDF_Doc pdf_doc, HPDF_Page pdf_page) {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_rows = 4;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_cols = 4;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#adab6f6dae9a3d74906eba7e4e92c0ea4">hpdftbl_set_errhandler</a>(<a class="code hl_function" href="hpdftbl_8c.html#a2ff1cca64859bc1acea1c323c5972f3d">hpdftbl_default_table_error_handler</a>);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="structhpdftbl.html">hpdftbl_t</a> tbl = <a class="code hl_function" href="hpdftbl_8c.html#ab14d35a34e1bf7633e7edcc92a273754">hpdftbl_create</a>(num_rows, num_cols);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#abd26b96fb00eb1a30862ee67f9328cc3">hpdftbl_set_colwidth_percent</a>(tbl, 0, 40);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#abd26b96fb00eb1a30862ee67f9328cc3">hpdftbl_set_colwidth_percent</a>(tbl, 1, 70);</div>
<div class="line"> </div>
<div class="line">    content_t content;</div>
<div class="line">    setup_dummy_content_with_header(&amp;content, num_rows, num_cols);</div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#a224e99bb4ded35c2da3f3ba1646ff7d2">hpdftbl_set_content</a>(tbl, content);</div>
<div class="line"> </div>
<div class="line">    HPDF_REAL xpos = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(1);</div>
<div class="line">    HPDF_REAL ypos = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(<a class="code hl_define" href="hpdftbl_8h.html#ac8ef7b15650c2dc4e44a4c2b75359dc2">A4PAGE_HEIGHT_CM</a> - 1);</div>
<div class="line">    HPDF_REAL width = <a class="code hl_define" href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a>(<a class="code hl_define" href="hpdftbl_8h.html#a74d6a937e9d5494f2fcf4b12783b7521">A4PAGE_WIDTH_CM</a> - 4);</div>
<div class="line">    HPDF_REAL height = 0;  <span class="comment">// Calculate height automatically</span></div>
<div class="line">    </div>
<div class="line">    <a class="code hl_function" href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a>(pdf_doc, pdf_page, tbl, xpos, ypos, width, height);</div>
<div class="line">}</div>
<div class="ttc" id="ahpdftbl_8c_html_a224e99bb4ded35c2da3f3ba1646ff7d2"><div class="ttname"><a href="hpdftbl_8c.html#a224e99bb4ded35c2da3f3ba1646ff7d2">hpdftbl_set_content</a></div><div class="ttdeci">int hpdftbl_set_content(hpdftbl_t t, char **content)</div><div class="ttdoc">Set the content for the table.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:1292</div></div>
<div class="ttc" id="ahpdftbl_8c_html_ab14d35a34e1bf7633e7edcc92a273754"><div class="ttname"><a href="hpdftbl_8c.html#ab14d35a34e1bf7633e7edcc92a273754">hpdftbl_create</a></div><div class="ttdeci">hpdftbl_t hpdftbl_create(size_t rows, size_t cols)</div><div class="ttdoc">Create a new table with no title.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:449</div></div>
<div class="ttc" id="ahpdftbl_8c_html_ae07ffb136a6e6fd7311afc0acf7cf763"><div class="ttname"><a href="hpdftbl_8c.html#ae07ffb136a6e6fd7311afc0acf7cf763">hpdftbl_stroke</a></div><div class="ttdeci">int hpdftbl_stroke(HPDF_Doc pdf, const HPDF_Page page, hpdftbl_t t, const HPDF_REAL xpos, const HPDF_REAL ypos, const HPDF_REAL width, HPDF_REAL height)</div><div class="ttdoc">Stroke the table.</div><div class="ttdef"><b>Definition:</b> hpdftbl.c:1898</div></div>
<div class="ttc" id="ahpdftbl_8h_html_a74d6a937e9d5494f2fcf4b12783b7521"><div class="ttname"><a href="hpdftbl_8h.html#a74d6a937e9d5494f2fcf4b12783b7521">A4PAGE_WIDTH_CM</a></div><div class="ttdeci">#define A4PAGE_WIDTH_CM</div><div class="ttdoc">Standard A4 paper width in cm.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:169</div></div>
<div class="ttc" id="ahpdftbl_8h_html_ac8ef7b15650c2dc4e44a4c2b75359dc2"><div class="ttname"><a href="hpdftbl_8h.html#ac8ef7b15650c2dc4e44a4c2b75359dc2">A4PAGE_HEIGHT_CM</a></div><div class="ttdeci">#define A4PAGE_HEIGHT_CM</div><div class="ttdoc">Standard A4 paper height in cm.</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:164</div></div>
<div class="ttc" id="ahpdftbl_8h_html_ad1b5b1c37e8832f507e65c595a7a2d00"><div class="ttname"><a href="hpdftbl_8h.html#ad1b5b1c37e8832f507e65c595a7a2d00">hpdftbl_cm2dpi</a></div><div class="ttdeci">#define hpdftbl_cm2dpi(c)</div><div class="ttdoc">Convert cm to dots using the default resolution (72 DPI)</div><div class="ttdef"><b>Definition:</b> hpdftbl.h:222</div></div>
</div><!-- fragment --><p >This is available in the example directory as <a class="el" href="tut_ex10_8c-example.html">tut_ex10.c</a>. When this code is executed the following will be printed to standard out and the process will be stopped.</p>
<div class="fragment"><div class="line">*** Table Error: [-12] &quot;Total column width exceeds 100%&quot;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 6 2022 05:43:30 for libhpdftbl by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
